if (typeof QUIZ_DB !== "undefined") {
  const test = new Vue({
    el: "#app",
    data: () => {
      return {
        quiz: QUIZ_DB,
        isEndOfTest: false,
        groupIndex: 0,
        questionIndex: 0,
        userResponses: [],
      };
    },
    created() {
      this.quiz.groups.forEach((group, gIndex) => {
        this.userResponses[gIndex] = {
          groupName: group.name,
          questions: [],
        };
        group.questions.forEach((element, qIndex) => {
          let correctAnswer = element.responses.find((value) => {
            return value.correct ? value.text : false;
          });
          this.userResponses[gIndex].questions[qIndex] = {
            text: element.text,
            correctAnswer: correctAnswer.text,
            userAnswer: null,
            isCorrect: false,
          };
        });
      });
    },
    methods: {
      handleRadio(value, text) {
        this.userResponses[this.groupIndex].questions[
          this.questionIndex
        ].isCorrect = value ? value : false;
        this.userResponses[this.groupIndex].questions[
          this.questionIndex
        ].userAnswer = text;
        let testDataElement = document.querySelector("#test-data");
        if (!testDataElement) {
          console.error("testDataElement with ID #test-data not found!");
        }
        testDataElement.value = JSON.stringify(this.userResponses);
      },
      next() {
        let inputs = document.querySelectorAll(".b-test-content__variable");
        inputs.forEach((el) => {
          if (el.matches(":checked")) {
            this.questionIndex++;
          }
        });
        // last question detection
        if (
          this.userResponses[this.groupIndex].questions.length - 1 ===
          this.questionIndex
        ) {
          //
        }
      },
      nextGroup() {
        // detect end of test
        if (this.userResponses.length - 1 === this.groupIndex) {
          this.isEndOfTest = true;
        } else {
          this.groupIndex++;
          this.questionIndex = 0;
        }
      },
      isLastGroupQuestion(gIndex) {
        return (
          this.userResponses[this.groupIndex].questions.length ===
            this.questionIndex && gIndex === this.groupIndex
        );
      },
      getQuestionCountInGroup(groupIndex) {
        return this.userResponses[groupIndex].questions.length;
      },
      getCountOfRightAnswersInGroup(groupIndex) {
        let cnt = 0;
        this.userResponses[groupIndex].questions.forEach((question, index) => {
          if (question.isCorrect) {
            cnt++;
          }
        });
        return cnt;
      },
      getCountOfRightAnswers() {
        let cnt = 0;
        this.userResponses.forEach((group, gIndex) => {
          cnt += this.getCountOfRightAnswersInGroup(gIndex);
        });
        return cnt;
      },
      getCountOfAllQuestions() {
        let cnt = 0;
        this.userResponses.forEach((group, gIndex) => {
          cnt += group.questions.length;
        });
        return cnt;
      },
    },
    computed: {
      currentValue() {
        return (
          Math.round(
            (100 / this.quiz.groups[this.groupIndex].questions.length) *
              this.questionIndex
          ) + "%"
        );
      },
      pageCounter() {
        return (
          this.questionIndex +
          1 +
          "/" +
          this.quiz.groups[this.groupIndex].questions.length
        );
      },
      showNextGroupBtn() {
        return this.userResponses.length - 1 !== this.groupIndex;
      },
    },
  });
}

//burger
const burger = document.querySelector(".b-burger");
const menu = document.querySelector(".b-menu");
burger.addEventListener("click", () => {
  burger.classList.toggle("active-burger");
  if (
    !menu.classList.contains("active-block") &&
    !menu.classList.contains("active-menu")
  ) {
    menu.classList.add("active-block");
    setTimeout(() => {
      menu.classList.add("active-menu");
    }, 100);
    document.body.classList.add("b-fixed");
  }
  if (
    menu.classList.contains("active-block") &&
    menu.classList.contains("active-menu")
  ) {
    menu.classList.remove("active-menu");
    setTimeout(() => {
      menu.classList.remove("active-block");
    }, 400);
    document.body.classList.remove("b-fixed");
  }
});

//ACCORDEON
const accordeonBtn = document.querySelectorAll("[data-accordeon-btn]");
const accordeonContent = document.querySelectorAll("[data-accordeon-content]");

accordeonBtn.forEach((el) => {
  el.addEventListener("click", (event) => {
    if (!el.classList.contains("active")) {
      cleanActivBtns();
      el.classList.add("active");
      const target = event.currentTarget.getAttribute("data-accordeon-btn");
      hideAccordeons();
      let currentAccordeon = document.querySelector(
        `[data-accordeon-content="${target}"]`
      );
      var accordeonChild = currentAccordeon.firstElementChild.scrollHeight;
      currentAccordeon.style.height = `calc(${accordeonChild}px + 10.6vw)`;
      currentAccordeon.classList.add("active");
    } else if (el.classList.contains("active")) {
      cleanActivBtns();
      hideAccordeons();
    }

    function hideAccordeons() {
      accordeonContent.forEach((el) => {
        el.style.height = "0";
        el.classList.remove("active");
      });
    }

    function cleanActivBtns() {
      accordeonBtn.forEach((el) => {
        el.classList.remove("active");
      });
    }
  });
});

//LOAD VIDEO from link after click 'play'
const videos = document.querySelectorAll(".b-video");
let generateUrl = function (id) {
  let query = "?rel=0&showinfo=0&autoplay=1";
  return "https://www.youtube.com/embed/" + id + query;
};
let createIframe = function (id) {
  let iframe = document.createElement("iframe");
  iframe.setAttribute("allowfullscreen", "");
  iframe.setAttribute("allow", "autoplay; encrypted-media");
  iframe.setAttribute("src", generateUrl(id));
  return iframe;
};
videos.forEach((el) => {
  let videoHref = el.getAttribute("data-video");
  let deletedLength = "https://www.youtube.com/watch?v=".length;
  let videoId = videoHref.substring(deletedLength, videoHref.length);
  let img = el.querySelector("img");
  let youtubeImgSrc =
    "https://i.ytimg.com/vi/" + videoId + "/maxresdefault.jpg";
  img.setAttribute("src", youtubeImgSrc);
  el.addEventListener("click", (e) => {
    e.preventDefault();
    let iframe = createIframe(videoId);
    el.querySelector("img").remove();
    el.appendChild(iframe);
    el.querySelector("button").remove();
  });
});

//---MODALS---
//hide all modals
const modalOpen = document.querySelectorAll("[data-modal-open]");
const modals = document.querySelectorAll("[data-modal]");
const moadalInner = document.querySelectorAll(".b-modal");
const closeModal = document.querySelectorAll("[data-modal-close]");

function hideModals() {
  modals.forEach((elem) => {
    elem.classList.remove("b-show");
  });
}

//find & open current modal, close rest & block scroll
modalOpen.forEach((elem) => {
  elem.addEventListener("click", (event) => {
    event.preventDefault();
    let target = event.currentTarget.getAttribute("data-modal-open");
    hideModals();
    document.body.classList.add("b-blockScroll");
    let targetModal = document.querySelector(`[data-modal="${target}"]`);
    targetModal.classList.add("b-show");
    let currentVideo = document.querySelector("video");
    if (targetModal.contains(currentVideo)) {
      currentVideo.play();
      currentVideo.setAttribute("data-play", "");
    }
  });
});

//close btn active
closeModal.forEach(
  (el) =>
    (el.onclick = () => {
      hideModals();
      document.body.classList.remove("b-blockScroll");
    })
);

//close to click overlay
window.addEventListener("click", function (e) {
  modals.forEach((el) => {
    if (el == e.target && e.target != moadalInner) {
      document.body.classList.remove("b-blockScroll");
      hideModals();
      closeVideo();
    }
  });
});

function closeVideo() {
  currentPlayVideo.forEach((el) => {
    el.pause();
    el.currentTime = 0;
  });
}

//sliders
const swiper = new Swiper(".mySwiper", {
  spaceBetween: 100,
  effect: "fade",
  centeredSlides: "true",
  clickable: "false",
  autoplay: {
    delay: 5000,
  },
  fadeEffect: {
    crossFade: true,
  },
  pagination: {
    el: ".swiper-pagination",
    type: "custom",
    renderCustom: function (swiper, current, total) {
      if (current < 10) {
        current = "0" + current;
      }
      if (total < 10) {
        total = "0" + total;
      }
      return current + " ... " + total;
    },
  },
  navigation: {
    nextEl: ".swiper-button-next",
    prevEl: ".swiper-button-prev",
  },
});

const slidesText = document.querySelectorAll(".b-slide-section__description");
for (let i = 0; i < slidesText.length - 1; i++) {
  const nextSlide = document.querySelector(".swiper-button-next");
  const prevSlide = document.querySelector(".swiper-button-prev");
  const slideSwape = document.querySelectorAll(".swiper-slide");
  let currentSlide = 0;

  const showSlide = () =>
    (slidesText[currentSlide].style = "opacity: 1; display: flex;");
  const hideSlide = () =>
    (slidesText[currentSlide].style = "opacity: 0; display: none;");
  const iterNext = () => currentSlide++;
  const iterPrev = () => currentSlide--;
  showSlide();

  nextSlide.addEventListener("click", () => [
    hideSlide(),
    iterNext(),
    showSlide(),
  ]);
  prevSlide.addEventListener("click", () => [
    hideSlide(),
    iterPrev(),
    showSlide(),
  ]);

  swiper.on("transitionEnd", function () {
    hideSlide();
    currentSlide = swiper.realIndex;
    showSlide();
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImlmICh0eXBlb2YgUVVJWl9EQiAhPT0gXCJ1bmRlZmluZWRcIikge1xuICBjb25zdCB0ZXN0ID0gbmV3IFZ1ZSh7XG4gICAgZWw6IFwiI2FwcFwiLFxuICAgIGRhdGE6ICgpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHF1aXo6IFFVSVpfREIsXG4gICAgICAgIGlzRW5kT2ZUZXN0OiBmYWxzZSxcbiAgICAgICAgZ3JvdXBJbmRleDogMCxcbiAgICAgICAgcXVlc3Rpb25JbmRleDogMCxcbiAgICAgICAgdXNlclJlc3BvbnNlczogW10sXG4gICAgICB9O1xuICAgIH0sXG4gICAgY3JlYXRlZCgpIHtcbiAgICAgIHRoaXMucXVpei5ncm91cHMuZm9yRWFjaCgoZ3JvdXAsIGdJbmRleCkgPT4ge1xuICAgICAgICB0aGlzLnVzZXJSZXNwb25zZXNbZ0luZGV4XSA9IHtcbiAgICAgICAgICBncm91cE5hbWU6IGdyb3VwLm5hbWUsXG4gICAgICAgICAgcXVlc3Rpb25zOiBbXSxcbiAgICAgICAgfTtcbiAgICAgICAgZ3JvdXAucXVlc3Rpb25zLmZvckVhY2goKGVsZW1lbnQsIHFJbmRleCkgPT4ge1xuICAgICAgICAgIGxldCBjb3JyZWN0QW5zd2VyID0gZWxlbWVudC5yZXNwb25zZXMuZmluZCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5jb3JyZWN0ID8gdmFsdWUudGV4dCA6IGZhbHNlO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMudXNlclJlc3BvbnNlc1tnSW5kZXhdLnF1ZXN0aW9uc1txSW5kZXhdID0ge1xuICAgICAgICAgICAgdGV4dDogZWxlbWVudC50ZXh0LFxuICAgICAgICAgICAgY29ycmVjdEFuc3dlcjogY29ycmVjdEFuc3dlci50ZXh0LFxuICAgICAgICAgICAgdXNlckFuc3dlcjogbnVsbCxcbiAgICAgICAgICAgIGlzQ29ycmVjdDogZmFsc2UsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgIGhhbmRsZVJhZGlvKHZhbHVlLCB0ZXh0KSB7XG4gICAgICAgIHRoaXMudXNlclJlc3BvbnNlc1t0aGlzLmdyb3VwSW5kZXhdLnF1ZXN0aW9uc1tcbiAgICAgICAgICB0aGlzLnF1ZXN0aW9uSW5kZXhcbiAgICAgICAgXS5pc0NvcnJlY3QgPSB2YWx1ZSA/IHZhbHVlIDogZmFsc2U7XG4gICAgICAgIHRoaXMudXNlclJlc3BvbnNlc1t0aGlzLmdyb3VwSW5kZXhdLnF1ZXN0aW9uc1tcbiAgICAgICAgICB0aGlzLnF1ZXN0aW9uSW5kZXhcbiAgICAgICAgXS51c2VyQW5zd2VyID0gdGV4dDtcbiAgICAgICAgbGV0IHRlc3REYXRhRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGVzdC1kYXRhXCIpO1xuICAgICAgICBpZiAoIXRlc3REYXRhRWxlbWVudCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJ0ZXN0RGF0YUVsZW1lbnQgd2l0aCBJRCAjdGVzdC1kYXRhIG5vdCBmb3VuZCFcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGVzdERhdGFFbGVtZW50LnZhbHVlID0gSlNPTi5zdHJpbmdpZnkodGhpcy51c2VyUmVzcG9uc2VzKTtcbiAgICAgIH0sXG4gICAgICBuZXh0KCkge1xuICAgICAgICBsZXQgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iLXRlc3QtY29udGVudF9fdmFyaWFibGVcIik7XG4gICAgICAgIGlucHV0cy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgIGlmIChlbC5tYXRjaGVzKFwiOmNoZWNrZWRcIikpIHtcbiAgICAgICAgICAgIHRoaXMucXVlc3Rpb25JbmRleCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGxhc3QgcXVlc3Rpb24gZGV0ZWN0aW9uXG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLnVzZXJSZXNwb25zZXNbdGhpcy5ncm91cEluZGV4XS5xdWVzdGlvbnMubGVuZ3RoIC0gMSA9PT1cbiAgICAgICAgICB0aGlzLnF1ZXN0aW9uSW5kZXhcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG5leHRHcm91cCgpIHtcbiAgICAgICAgLy8gZGV0ZWN0IGVuZCBvZiB0ZXN0XG4gICAgICAgIGlmICh0aGlzLnVzZXJSZXNwb25zZXMubGVuZ3RoIC0gMSA9PT0gdGhpcy5ncm91cEluZGV4KSB7XG4gICAgICAgICAgdGhpcy5pc0VuZE9mVGVzdCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5ncm91cEluZGV4Kys7XG4gICAgICAgICAgdGhpcy5xdWVzdGlvbkluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGlzTGFzdEdyb3VwUXVlc3Rpb24oZ0luZGV4KSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgdGhpcy51c2VyUmVzcG9uc2VzW3RoaXMuZ3JvdXBJbmRleF0ucXVlc3Rpb25zLmxlbmd0aCA9PT1cbiAgICAgICAgICAgIHRoaXMucXVlc3Rpb25JbmRleCAmJiBnSW5kZXggPT09IHRoaXMuZ3JvdXBJbmRleFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIGdldFF1ZXN0aW9uQ291bnRJbkdyb3VwKGdyb3VwSW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXNlclJlc3BvbnNlc1tncm91cEluZGV4XS5xdWVzdGlvbnMubGVuZ3RoO1xuICAgICAgfSxcbiAgICAgIGdldENvdW50T2ZSaWdodEFuc3dlcnNJbkdyb3VwKGdyb3VwSW5kZXgpIHtcbiAgICAgICAgbGV0IGNudCA9IDA7XG4gICAgICAgIHRoaXMudXNlclJlc3BvbnNlc1tncm91cEluZGV4XS5xdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24sIGluZGV4KSA9PiB7XG4gICAgICAgICAgaWYgKHF1ZXN0aW9uLmlzQ29ycmVjdCkge1xuICAgICAgICAgICAgY250Kys7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNudDtcbiAgICAgIH0sXG4gICAgICBnZXRDb3VudE9mUmlnaHRBbnN3ZXJzKCkge1xuICAgICAgICBsZXQgY250ID0gMDtcbiAgICAgICAgdGhpcy51c2VyUmVzcG9uc2VzLmZvckVhY2goKGdyb3VwLCBnSW5kZXgpID0+IHtcbiAgICAgICAgICBjbnQgKz0gdGhpcy5nZXRDb3VudE9mUmlnaHRBbnN3ZXJzSW5Hcm91cChnSW5kZXgpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNudDtcbiAgICAgIH0sXG4gICAgICBnZXRDb3VudE9mQWxsUXVlc3Rpb25zKCkge1xuICAgICAgICBsZXQgY250ID0gMDtcbiAgICAgICAgdGhpcy51c2VyUmVzcG9uc2VzLmZvckVhY2goKGdyb3VwLCBnSW5kZXgpID0+IHtcbiAgICAgICAgICBjbnQgKz0gZ3JvdXAucXVlc3Rpb25zLmxlbmd0aDtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjbnQ7XG4gICAgICB9LFxuICAgIH0sXG4gICAgY29tcHV0ZWQ6IHtcbiAgICAgIGN1cnJlbnRWYWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgKDEwMCAvIHRoaXMucXVpei5ncm91cHNbdGhpcy5ncm91cEluZGV4XS5xdWVzdGlvbnMubGVuZ3RoKSAqXG4gICAgICAgICAgICAgIHRoaXMucXVlc3Rpb25JbmRleFxuICAgICAgICAgICkgKyBcIiVcIlxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIHBhZ2VDb3VudGVyKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIHRoaXMucXVlc3Rpb25JbmRleCArXG4gICAgICAgICAgMSArXG4gICAgICAgICAgXCIvXCIgK1xuICAgICAgICAgIHRoaXMucXVpei5ncm91cHNbdGhpcy5ncm91cEluZGV4XS5xdWVzdGlvbnMubGVuZ3RoXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgc2hvd05leHRHcm91cEJ0bigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXNlclJlc3BvbnNlcy5sZW5ndGggLSAxICE9PSB0aGlzLmdyb3VwSW5kZXg7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xufVxuXG4vL2J1cmdlclxuY29uc3QgYnVyZ2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5iLWJ1cmdlclwiKTtcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmItbWVudVwiKTtcbmJ1cmdlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBidXJnZXIuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZS1idXJnZXJcIik7XG4gIGlmIChcbiAgICAhbWVudS5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmUtYmxvY2tcIikgJiZcbiAgICAhbWVudS5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmUtbWVudVwiKVxuICApIHtcbiAgICBtZW51LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmUtYmxvY2tcIik7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBtZW51LmNsYXNzTGlzdC5hZGQoXCJhY3RpdmUtbWVudVwiKTtcbiAgICB9LCAxMDApO1xuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcImItZml4ZWRcIik7XG4gIH1cbiAgaWYgKFxuICAgIG1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYWN0aXZlLWJsb2NrXCIpICYmXG4gICAgbWVudS5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmUtbWVudVwiKVxuICApIHtcbiAgICBtZW51LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmUtbWVudVwiKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIG1lbnUuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZS1ibG9ja1wiKTtcbiAgICB9LCA0MDApO1xuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImItZml4ZWRcIik7XG4gIH1cbn0pO1xuXG4vL0FDQ09SREVPTlxuY29uc3QgYWNjb3JkZW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLWFjY29yZGVvbi1idG5dXCIpO1xuY29uc3QgYWNjb3JkZW9uQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS1hY2NvcmRlb24tY29udGVudF1cIik7XG5cbmFjY29yZGVvbkJ0bi5mb3JFYWNoKChlbCkgPT4ge1xuICBlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgaWYgKCFlbC5jbGFzc0xpc3QuY29udGFpbnMoXCJhY3RpdmVcIikpIHtcbiAgICAgIGNsZWFuQWN0aXZCdG5zKCk7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWFjY29yZGVvbi1idG5cIik7XG4gICAgICBoaWRlQWNjb3JkZW9ucygpO1xuICAgICAgbGV0IGN1cnJlbnRBY2NvcmRlb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgW2RhdGEtYWNjb3JkZW9uLWNvbnRlbnQ9XCIke3RhcmdldH1cIl1gXG4gICAgICApO1xuICAgICAgdmFyIGFjY29yZGVvbkNoaWxkID0gY3VycmVudEFjY29yZGVvbi5maXJzdEVsZW1lbnRDaGlsZC5zY3JvbGxIZWlnaHQ7XG4gICAgICBjdXJyZW50QWNjb3JkZW9uLnN0eWxlLmhlaWdodCA9IGBjYWxjKCR7YWNjb3JkZW9uQ2hpbGR9cHggKyAxMC42dncpYDtcbiAgICAgIGN1cnJlbnRBY2NvcmRlb24uY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcbiAgICB9IGVsc2UgaWYgKGVsLmNsYXNzTGlzdC5jb250YWlucyhcImFjdGl2ZVwiKSkge1xuICAgICAgY2xlYW5BY3RpdkJ0bnMoKTtcbiAgICAgIGhpZGVBY2NvcmRlb25zKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGlkZUFjY29yZGVvbnMoKSB7XG4gICAgICBhY2NvcmRlb25Db250ZW50LmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGVsLnN0eWxlLmhlaWdodCA9IFwiMFwiO1xuICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xlYW5BY3RpdkJ0bnMoKSB7XG4gICAgICBhY2NvcmRlb25CdG4uZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59KTtcblxuLy9MT0FEIFZJREVPIGZyb20gbGluayBhZnRlciBjbGljayAncGxheSdcbmNvbnN0IHZpZGVvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYi12aWRlb1wiKTtcbmxldCBnZW5lcmF0ZVVybCA9IGZ1bmN0aW9uIChpZCkge1xuICBsZXQgcXVlcnkgPSBcIj9yZWw9MCZzaG93aW5mbz0wJmF1dG9wbGF5PTFcIjtcbiAgcmV0dXJuIFwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvXCIgKyBpZCArIHF1ZXJ5O1xufTtcbmxldCBjcmVhdGVJZnJhbWUgPSBmdW5jdGlvbiAoaWQpIHtcbiAgbGV0IGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG4gIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd2Z1bGxzY3JlZW5cIiwgXCJcIik7XG4gIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJhbGxvd1wiLCBcImF1dG9wbGF5OyBlbmNyeXB0ZWQtbWVkaWFcIik7XG4gIGlmcmFtZS5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgZ2VuZXJhdGVVcmwoaWQpKTtcbiAgcmV0dXJuIGlmcmFtZTtcbn07XG52aWRlb3MuZm9yRWFjaCgoZWwpID0+IHtcbiAgbGV0IHZpZGVvSHJlZiA9IGVsLmdldEF0dHJpYnV0ZShcImRhdGEtdmlkZW9cIik7XG4gIGxldCBkZWxldGVkTGVuZ3RoID0gXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVwiLmxlbmd0aDtcbiAgbGV0IHZpZGVvSWQgPSB2aWRlb0hyZWYuc3Vic3RyaW5nKGRlbGV0ZWRMZW5ndGgsIHZpZGVvSHJlZi5sZW5ndGgpO1xuICBsZXQgaW1nID0gZWwucXVlcnlTZWxlY3RvcihcImltZ1wiKTtcbiAgbGV0IHlvdXR1YmVJbWdTcmMgPVxuICAgIFwiaHR0cHM6Ly9pLnl0aW1nLmNvbS92aS9cIiArIHZpZGVvSWQgKyBcIi9tYXhyZXNkZWZhdWx0LmpwZ1wiO1xuICBpbWcuc2V0QXR0cmlidXRlKFwic3JjXCIsIHlvdXR1YmVJbWdTcmMpO1xuICBlbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IGlmcmFtZSA9IGNyZWF0ZUlmcmFtZSh2aWRlb0lkKTtcbiAgICBlbC5xdWVyeVNlbGVjdG9yKFwiaW1nXCIpLnJlbW92ZSgpO1xuICAgIGVsLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gICAgZWwucXVlcnlTZWxlY3RvcihcImJ1dHRvblwiKS5yZW1vdmUoKTtcbiAgfSk7XG59KTtcblxuLy8tLS1NT0RBTFMtLS1cbi8vaGlkZSBhbGwgbW9kYWxzXG5jb25zdCBtb2RhbE9wZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtbW9kYWwtb3Blbl1cIik7XG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtbW9kYWxdXCIpO1xuY29uc3QgbW9hZGFsSW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmItbW9kYWxcIik7XG5jb25zdCBjbG9zZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltkYXRhLW1vZGFsLWNsb3NlXVwiKTtcblxuZnVuY3Rpb24gaGlkZU1vZGFscygpIHtcbiAgbW9kYWxzLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICBlbGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJiLXNob3dcIik7XG4gIH0pO1xufVxuXG4vL2ZpbmQgJiBvcGVuIGN1cnJlbnQgbW9kYWwsIGNsb3NlIHJlc3QgJiBibG9jayBzY3JvbGxcbm1vZGFsT3Blbi5mb3JFYWNoKChlbGVtKSA9PiB7XG4gIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IHRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1tb2RhbC1vcGVuXCIpO1xuICAgIGhpZGVNb2RhbHMoKTtcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJiLWJsb2NrU2Nyb2xsXCIpO1xuICAgIGxldCB0YXJnZXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLW1vZGFsPVwiJHt0YXJnZXR9XCJdYCk7XG4gICAgdGFyZ2V0TW9kYWwuY2xhc3NMaXN0LmFkZChcImItc2hvd1wiKTtcbiAgICBsZXQgY3VycmVudFZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcInZpZGVvXCIpO1xuICAgIGlmICh0YXJnZXRNb2RhbC5jb250YWlucyhjdXJyZW50VmlkZW8pKSB7XG4gICAgICBjdXJyZW50VmlkZW8ucGxheSgpO1xuICAgICAgY3VycmVudFZpZGVvLnNldEF0dHJpYnV0ZShcImRhdGEtcGxheVwiLCBcIlwiKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbi8vY2xvc2UgYnRuIGFjdGl2ZVxuY2xvc2VNb2RhbC5mb3JFYWNoKFxuICAoZWwpID0+XG4gICAgKGVsLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICBoaWRlTW9kYWxzKCk7XG4gICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJiLWJsb2NrU2Nyb2xsXCIpO1xuICAgIH0pXG4pO1xuXG4vL2Nsb3NlIHRvIGNsaWNrIG92ZXJsYXlcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgbW9kYWxzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgaWYgKGVsID09IGUudGFyZ2V0ICYmIGUudGFyZ2V0ICE9IG1vYWRhbElubmVyKSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJiLWJsb2NrU2Nyb2xsXCIpO1xuICAgICAgaGlkZU1vZGFscygpO1xuICAgICAgY2xvc2VWaWRlbygpO1xuICAgIH1cbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gY2xvc2VWaWRlbygpIHtcbiAgY3VycmVudFBsYXlWaWRlby5mb3JFYWNoKChlbCkgPT4ge1xuICAgIGVsLnBhdXNlKCk7XG4gICAgZWwuY3VycmVudFRpbWUgPSAwO1xuICB9KTtcbn1cblxuLy9zbGlkZXJzXG5jb25zdCBzd2lwZXIgPSBuZXcgU3dpcGVyKFwiLm15U3dpcGVyXCIsIHtcbiAgc3BhY2VCZXR3ZWVuOiAxMDAsXG4gIGVmZmVjdDogXCJmYWRlXCIsXG4gIGNlbnRlcmVkU2xpZGVzOiBcInRydWVcIixcbiAgY2xpY2thYmxlOiBcImZhbHNlXCIsXG4gIGF1dG9wbGF5OiB7XG4gICAgZGVsYXk6IDUwMDAsXG4gIH0sXG4gIGZhZGVFZmZlY3Q6IHtcbiAgICBjcm9zc0ZhZGU6IHRydWUsXG4gIH0sXG4gIHBhZ2luYXRpb246IHtcbiAgICBlbDogXCIuc3dpcGVyLXBhZ2luYXRpb25cIixcbiAgICB0eXBlOiBcImN1c3RvbVwiLFxuICAgIHJlbmRlckN1c3RvbTogZnVuY3Rpb24gKHN3aXBlciwgY3VycmVudCwgdG90YWwpIHtcbiAgICAgIGlmIChjdXJyZW50IDwgMTApIHtcbiAgICAgICAgY3VycmVudCA9IFwiMFwiICsgY3VycmVudDtcbiAgICAgIH1cbiAgICAgIGlmICh0b3RhbCA8IDEwKSB7XG4gICAgICAgIHRvdGFsID0gXCIwXCIgKyB0b3RhbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjdXJyZW50ICsgXCIgLi4uIFwiICsgdG90YWw7XG4gICAgfSxcbiAgfSxcbiAgbmF2aWdhdGlvbjoge1xuICAgIG5leHRFbDogXCIuc3dpcGVyLWJ1dHRvbi1uZXh0XCIsXG4gICAgcHJldkVsOiBcIi5zd2lwZXItYnV0dG9uLXByZXZcIixcbiAgfSxcbn0pO1xuXG5jb25zdCBzbGlkZXNUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5iLXNsaWRlLXNlY3Rpb25fX2Rlc2NyaXB0aW9uXCIpO1xuZm9yIChsZXQgaSA9IDA7IGkgPCBzbGlkZXNUZXh0Lmxlbmd0aCAtIDE7IGkrKykge1xuICBjb25zdCBuZXh0U2xpZGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN3aXBlci1idXR0b24tbmV4dFwiKTtcbiAgY29uc3QgcHJldlNsaWRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zd2lwZXItYnV0dG9uLXByZXZcIik7XG4gIGNvbnN0IHNsaWRlU3dhcGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN3aXBlci1zbGlkZVwiKTtcbiAgbGV0IGN1cnJlbnRTbGlkZSA9IDA7XG5cbiAgY29uc3Qgc2hvd1NsaWRlID0gKCkgPT5cbiAgICAoc2xpZGVzVGV4dFtjdXJyZW50U2xpZGVdLnN0eWxlID0gXCJvcGFjaXR5OiAxOyBkaXNwbGF5OiBmbGV4O1wiKTtcbiAgY29uc3QgaGlkZVNsaWRlID0gKCkgPT5cbiAgICAoc2xpZGVzVGV4dFtjdXJyZW50U2xpZGVdLnN0eWxlID0gXCJvcGFjaXR5OiAwOyBkaXNwbGF5OiBub25lO1wiKTtcbiAgY29uc3QgaXRlck5leHQgPSAoKSA9PiBjdXJyZW50U2xpZGUrKztcbiAgY29uc3QgaXRlclByZXYgPSAoKSA9PiBjdXJyZW50U2xpZGUtLTtcbiAgc2hvd1NsaWRlKCk7XG5cbiAgbmV4dFNsaWRlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBbXG4gICAgaGlkZVNsaWRlKCksXG4gICAgaXRlck5leHQoKSxcbiAgICBzaG93U2xpZGUoKSxcbiAgXSk7XG4gIHByZXZTbGlkZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gW1xuICAgIGhpZGVTbGlkZSgpLFxuICAgIGl0ZXJQcmV2KCksXG4gICAgc2hvd1NsaWRlKCksXG4gIF0pO1xuXG4gIHN3aXBlci5vbihcInRyYW5zaXRpb25FbmRcIiwgZnVuY3Rpb24gKCkge1xuICAgIGhpZGVTbGlkZSgpO1xuICAgIGN1cnJlbnRTbGlkZSA9IHN3aXBlci5yZWFsSW5kZXg7XG4gICAgc2hvd1NsaWRlKCk7XG4gIH0pO1xufVxuIl19
